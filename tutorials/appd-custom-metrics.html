<!DOCTYPE html>
<head>
    <title>AppD Custom Metrics</title>
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="../assets/css/style.css">

    <style>
        .navbar-ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #333;
        }

        .navbar-li {
            float: left;
        }

        .navbar-lia {
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        li a:hover:not(.active) {
            background-color: #111;
        }

        .active {
            background-color: #16AA9D;
        }
        .img-container {
            text-align: center;
        }
    </style>


  </head>

  <body>

    <ul class="navbar-ul">
        <li class="navbar-li"><a class="navbar-lia" href="../index.html">Home</a></li>
        <li class="navbar-li"><a class="active navbar-lia" href="../tutorials.html">Tutorials</a></li>
        <li class="navbar-li"><a class="navbar-lia" href="../contact.html">Contact</a></li>
        <li class="navbar-li"><a class="navbar-lia" href="../about.html">About</a></li>
    </ul>


<h2 style="color:#fff;">Pushing AppD Custom Metrics</h2>

<div><img src="/assets/images/appd.png"></div>

<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <p>In this tutorial, I will introduce how to publish custom metrics from a server into the AppDynamics controller. Let&#39;s start with what exactly AppDynamics is why we may use it. <a href="https://www.appdynamics.com/">AppDynamics</a> (or AppD for short) is an agent-based (i.e. node-local process that ships metrics to a centralized controller) enterprise monitoring tool that specializes in Application Performance Monitoring (or APM). It does this by converting various different application aspects into what AppD calls &quot;business transactions&quot;. These business transactions can be API calls, database queries, logins, server restarts, auto-scaling invocations, and much more. It then compares these events against a baseline of events that it measures and compares against over the lifetime of monitoring the application. Therefore, the longer you have AppD installed, the smarter it becomes about your application and the more refined its alerting and remediation capabilities can be.</p>
<p>AppD can typically determine business transactions if you just give it a few hours to observe the application - or even better, a full business week to cover all load differentials that could arise throughout the week. However, sometimes what the tool determines as &quot;important&quot; is actually not, or it misses some key aspects of your application you want to capture. In these cases, we can actually use AppDynamic&#39;s custom metrics feature to write scripts locally on our nodes and export the metrics we want to the AppD contoller. Even if your metrics aren&#39;t initially found by AppD, it&#39;s still important to ship your custom metrics to the controller to live with all of your other measurements. With all of the metrics in one place, we can still trend against baselines and alert on abnormal values whether the metric was picked up by AppD initially or had been pushed through a custom script.</p>
<p>AppD has great <a href="https://docs.appdynamics.com/display/PRO45/Build+a+Monitoring+Extension+Using+Scripts">documentation</a> for custom metrics, but I hope to simplify and cut down some of the noise in the following tutorial. In order for AppD to monitor our application or servers, we need to install at least the <a href="https://docs.appdynamics.com/display/PRO45/Standalone+Machine+Agent">machine agent</a> and if we want even more application monitoring, we can install the <a href="https://docs.appdynamics.com/display/PRO45/Install+App+Server+Agents">process-specific agent</a> provided by AppD (i.e. the Java agent for monitoring Java processes).</p>
<p>The installation of these monitoring agents is outside the scope of this tutorial, but the documentation I linked should be sufficient to get them up and running. Our custom metrics will ship through the machine agent, so it&#39;s important to have that installed. Another vital piece to shipping our metrics is the directory structure of our scripts and configurations. Within the same directory that the AppD machine agent is installed in will be a <code>/monitors</code> sub-directory. If this does not exist, feel free to create it. In the <code>/monitors</code> directory, there will need to be another sub-directory for each custom metric we want to ship. For example, if we want to create a custom metric that returns a count of the number of JVMs currently running on the system, we would have a directory structure of:</p>
<p> <code>&lt;appd_machine_agent_directory&gt;/monitors/jvm-count</code></p>
<p>Inside our custom directory, we will have three files (again, three files <em>per</em> metric we want to ship): <code>config.yml</code>, <code>monitor.xml</code>, and our main script, which we will call <code>jvm-count.sh</code>. Typically it&#39;s best practice to name this script the same as the directory it is located in, and that will be the same name we will find in the AppDynamics controller. <code>monitor.xml</code> will tell the machine agent how to call our script and what metadata to associate with it. The<code>config.yml</code> file will hold very specific configurations for how the script runs such as number of threads to execute, script execution delays, etc. Finally, the <code>jvm-count.sh</code> will be our script that echoes our metric to STDOUT for the AppD machine agent to pick up and ship to the controller.</p>

    </section>
  </div>
